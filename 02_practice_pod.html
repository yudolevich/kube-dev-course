<!DOCTYPE html>
<html class="writer-html5" lang="ru" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Работа с Pod &mdash; документация kube-dev-course </title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/copybutton.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script src="_static/clipboard.min.js"></script>
        <script src="_static/copybutton.js"></script>
        <script src="_static/translations.js"></script>
        <script src="https://unpkg.com/mermaid@9.4.0/dist/mermaid.min.js"></script>
        <script>mermaid.initialize({startOnLoad:true});</script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Алфавитный указатель" href="genindex.html" />
    <link rel="search" title="Поиск" href="search.html" />
    <link rel="next" title="Workloads" href="03_practice_workloads.html" />
    <link rel="prev" title="Основы работы с kubernetes" href="01_practice_core.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            kube-dev-course
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Поиск в документации" aria-label="Поиск в документации" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Меню навигации">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_topic_core.html">Основные концепции</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_topic_pod.html">Pod</a></li>
<li class="toctree-l1"><a class="reference internal" href="03_topic_workloads.html">Workloads</a></li>
<li class="toctree-l1"><a class="reference internal" href="04_topic_netbalance.html">Network</a></li>
<li class="toctree-l1"><a class="reference internal" href="05_topic_storage.html">Storage</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_topic_accesscontrol.html">Access Control</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="practice.html">Практика</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="01_practice_core.html">Основы работы с kubernetes</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Работа с Pod</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#id1">Создание</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id2">Получение информации</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id3">Логи</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id4">Проброс портов</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id5">Запуск команд в контейнере</a></li>
<li class="toctree-l3"><a class="reference internal" href="#id6">Копирование файлов контейнера</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configmap-secret">Использование ConfigMap/Secret</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="03_practice_workloads.html">Workloads</a></li>
<li class="toctree-l2"><a class="reference internal" href="04_practice_netbalance.html">LoadBalance</a></li>
<li class="toctree-l2"><a class="reference internal" href="05_practice_storage.html">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="06_practice_accesscontrol.html">Access Control</a></li>
<li class="toctree-l2"><a class="reference internal" href="07_practice_helm.html">Kustomize/Helm</a></li>
<li class="toctree-l2"><a class="reference internal" href="08_practice_operator.html">Operator</a></li>
</ul>
</li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Меню навигации для мобильных устройств" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">kube-dev-course</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Навигация по страницам">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="practice.html">Практика</a></li>
      <li class="breadcrumb-item active">Работа с Pod</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/02_practice_pod.md.txt" rel="nofollow"> Просмотреть исходный код страницы</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="pod">
<h1>Работа с Pod<a class="headerlink" href="#pod" title="Permalink to this heading"></a></h1>
<p>Для практики с подами нам также понадобится установленный <code class="docutils literal notranslate"><span class="pre">kind</span></code> и утилита <code class="docutils literal notranslate"><span class="pre">kubectl</span></code>, для удобства
можно стереть все данные от предыдущей работы и пересоздать кластер командами:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kind<span class="w"> </span>delete<span class="w"> </span>cluster
<span class="gp">$ </span>kind<span class="w"> </span>create<span class="w"> </span>cluster
</pre></div>
</div>
<p>Либо можно удалить все оставшиеся поды в неймспейсе командой:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>--all
<span class="go">pod &quot;nginx&quot; deleted</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Примечание</p>
<p>Для удобства и компактности для команды <code class="docutils literal notranslate"><span class="pre">kubectl</span></code> будет использоваться псевдоним <code class="docutils literal notranslate"><span class="pre">k</span></code>.
Как его сделать описано в предыдущем практическом занятии.</p>
</div>
<p>Так как большинство полей в поде неизменяемые, то в этом занятии будет использоваться команда
<code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">create</span></code> для создания пода, а вместо изменения под будет удаляться командой <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">delete</span></code>.</p>
<section id="id1">
<h2>Создание<a class="headerlink" href="#id1" title="Permalink to this heading"></a></h2>
<p>Создать под можно командой <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">create</span> <span class="pre">-f</span> <span class="pre">-</span></code>, которая будет ожидать ввода из потока стандартного
ввода вместо файла, таким образом можно просто вставить текст в терминал, перевести на новую строку
и нажать <code class="docutils literal notranslate"><span class="pre">Ctrl+d</span></code>. Также можно воспользоваться синтаксисом <a class="reference external" href="https://en.wikipedia.org/wiki/Here_document">heredoc</a> в шеле, чтобы передать на
стандартный ввод текст между разделителями, в данном случае <code class="docutils literal notranslate"><span class="pre">EOF</span></code>:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>k<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Pod</span>
<span class="s">metadata:</span>
<span class="s">  labels:</span>
<span class="s">    run: nginx</span>
<span class="s">  name: nginx</span>
<span class="s">spec:</span>
<span class="s">  containers:</span>
<span class="s">  - image: nginx</span>
<span class="s">    name: nginx</span>
<span class="s">EOF</span>
pod/nginx<span class="w"> </span>created
</pre></div>
</div>
</section>
<section id="id2">
<h2>Получение информации<a class="headerlink" href="#id2" title="Permalink to this heading"></a></h2>
<p>Получить подробную информацию о поде в удобном формате можно командой <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">describe</span> <span class="pre">pod</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kubectl<span class="w"> </span>describe<span class="w"> </span>po<span class="w"> </span>nginx
<span class="go">Name:             nginx</span>
<span class="go">Namespace:        default</span>
<span class="go">Priority:         0</span>
<span class="go">Service Account:  default</span>
<span class="go">Node:             kind-worker/172.18.0.3</span>
<span class="go">Start Time:       Mon, 06 Mar 2023 21:02:20 +0300</span>
<span class="go">Labels:           run=nginx</span>
<span class="go">Annotations:      &lt;none&gt;</span>
<span class="go">Status:           Running</span>
<span class="go">IP:               10.244.2.5</span>
<span class="go">IPs:</span>
<span class="go">  IP:  10.244.2.5</span>
<span class="go">Containers:</span>
<span class="go">  nginx:</span>
<span class="go">    Container ID:   containerd://883f111c6fb037bc1991cf2bde34a91e4d3e8238e93aba1d54415243bd4f28c0</span>
<span class="go">    Image:          nginx</span>
<span class="go">    Image ID:       docker.io/library/nginx@sha256:aa0afebbb3cfa473099a62c4b32e9b3fb73ed23f2a75a65ce1d4b4f55a5c2ef2</span>
<span class="go">    Port:           &lt;none&gt;</span>
<span class="go">    Host Port:      &lt;none&gt;</span>
<span class="go">    State:          Running</span>
<span class="go">      Started:      Mon, 06 Mar 2023 21:02:22 +0300</span>
<span class="go">    Ready:          True</span>
<span class="go">    Restart Count:  0</span>
<span class="go">    Environment:    &lt;none&gt;</span>
<span class="go">    Mounts:</span>
<span class="go">      /var/run/secrets/kubernetes.io/serviceaccount from kube-api-access-7jkrp (ro)</span>
<span class="go">Conditions:</span>
<span class="go">  Type              Status</span>
<span class="go">  Initialized       True</span>
<span class="go">  Ready             True</span>
<span class="go">  ContainersReady   True</span>
<span class="go">  PodScheduled      True</span>
<span class="go">Volumes:</span>
<span class="go">  kube-api-access-7jkrp:</span>
<span class="go">    Type:                    Projected (a volume that contains injected data from multiple sources)</span>
<span class="go">    TokenExpirationSeconds:  3607</span>
<span class="go">    ConfigMapName:           kube-root-ca.crt</span>
<span class="go">    ConfigMapOptional:       &lt;nil&gt;</span>
<span class="go">    DownwardAPI:             true</span>
<span class="go">QoS Class:                   BestEffort</span>
<span class="go">Node-Selectors:              &lt;none&gt;</span>
<span class="go">Tolerations:                 node.kubernetes.io/not-ready:NoExecute op=Exists for 300s</span>
<span class="go">                             node.kubernetes.io/unreachable:NoExecute op=Exists for 300s</span>
<span class="go">Events:</span>
<span class="go">  Type    Reason     Age   From               Message</span>
<span class="go">  ----    ------     ----  ----               -------</span>
<span class="go">  Normal  Scheduled  27m   default-scheduler  Successfully assigned default/nginx to kind-worker</span>
<span class="go">  Normal  Pulling    27m   kubelet            Pulling image &quot;nginx&quot;</span>
<span class="go">  Normal  Pulled     27m   kubelet            Successfully pulled image &quot;nginx&quot; in 1.094512433s</span>
<span class="go">  Normal  Created    27m   kubelet            Created container nginx</span>
<span class="go">  Normal  Started    27m   kubelet            Started container nginx</span>
</pre></div>
</div>
<p>Также информацию можно получить в различных форматах с помощью опции <code class="docutils literal notranslate"><span class="pre">-o</span></code> команды <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">get</span></code>.</p>
<p>Вывод только имен <code class="docutils literal notranslate"><span class="pre">name</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>-o<span class="w"> </span>name
<span class="go">pod/nginx</span>
</pre></div>
</div>
<p>Расширенный вывод <code class="docutils literal notranslate"><span class="pre">wide</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>nginx<span class="w"> </span>-o<span class="w"> </span>wide
<span class="go">NAME    READY   STATUS    RESTARTS   AGE   IP           NODE          NOMINATED NODE   READINESS GATES</span>
<span class="go">nginx   1/1     Running   0          31m   10.244.2.5   kind-worker   &lt;none&gt;           &lt;none&gt;</span>
</pre></div>
</div>
<p>Формат <code class="docutils literal notranslate"><span class="pre">yaml/json</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>nginx<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span><span class="p">|</span><span class="w"> </span>head<span class="w"> </span>-15
<span class="go">apiVersion: v1</span>
<span class="go">kind: Pod</span>
<span class="go">metadata:</span>
<span class="go">  creationTimestamp: &quot;2023-03-06T18:02:20Z&quot;</span>
<span class="go">  labels:</span>
<span class="go">    run: nginx</span>
<span class="go">  name: nginx</span>
<span class="go">  namespace: default</span>
<span class="go">  resourceVersion: &quot;19432&quot;</span>
<span class="go">  uid: ce208149-7f16-4226-b50a-f916854cbca3</span>
<span class="go">spec:</span>
<span class="go">  containers:</span>
<span class="go">  - image: nginx</span>
<span class="go">    imagePullPolicy: Always</span>
<span class="go">    name: nginx</span>
</pre></div>
</div>
<p>Шаблон <code class="docutils literal notranslate"><span class="pre">jsonpath</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>nginx<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.containers[0].image}&#39;</span>
<span class="go">nginx</span>
</pre></div>
</div>
<p>Шаблон <code class="docutils literal notranslate"><span class="pre">go-template</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>nginx<span class="w"> </span>-o<span class="w"> </span>go-template<span class="o">=</span><span class="s1">&#39;{{range .spec.containers}}{{.image}}{{&quot;\n&quot;}}{{end}}&#39;</span>
<span class="go">nginx</span>
</pre></div>
</div>
<p><a class="reference external" href="https://kubernetes.io/docs/reference/kubectl/#custom-columns">Заданный формат столбцов</a>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>nginx<span class="w"> </span>-o<span class="w"> </span>custom-columns<span class="o">=</span>NAME:.metadata.name
<span class="go">NAME</span>
<span class="go">nginx</span>
</pre></div>
</div>
<p>Также очень популярная в использовании утилита <a class="reference external" href="https://stedolan.github.io/jq/">jq</a> для форматирования вывода в виде <code class="docutils literal notranslate"><span class="pre">json</span></code>:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>get<span class="w"> </span>po<span class="w"> </span>nginx<span class="w"> </span>-o<span class="w"> </span>json<span class="w"> </span><span class="p">|</span><span class="w"> </span>jq<span class="w"> </span><span class="s1">&#39;.status.conditions[] | select(.type == &quot;ContainersReady&quot;) | .status&#39;</span>
<span class="go">&quot;True&quot;</span>
</pre></div>
</div>
</section>
<section id="id3">
<h2>Логи<a class="headerlink" href="#id3" title="Permalink to this heading"></a></h2>
<p>Получить логи контейнера можно командой <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">logs</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>logs<span class="w"> </span>nginx
<span class="go">/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span>
<span class="go">/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span>
<span class="go">/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span>
<span class="go">10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span>
<span class="go">10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span>
<span class="go">/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span>
<span class="go">/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span>
<span class="go">/docker-entrypoint.sh: Configuration complete; ready for start up</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: using the &quot;epoll&quot; event method</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: nginx/1.23.3</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6)</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: OS: Linux 4.19.130-boot2docker</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: start worker processes</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: start worker process 35</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: start worker process 36</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: start worker process 37</span>
<span class="go">2023/03/06 18:02:22 [notice] 1#1: start worker process 38</span>
<span class="go">127.0.0.1 - - [06/Mar/2023:18:27:10 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.79.1&quot; &quot;-&quot;</span>
</pre></div>
</div>
<p>Чтобы вывести только последние несколько строк, можно воспользоваться опцией <code class="docutils literal notranslate"><span class="pre">--tail=&lt;n&gt;</span></code>, где
<code class="docutils literal notranslate"><span class="pre">&lt;n&gt;</span></code> - количество последних строк.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>logs<span class="w"> </span>nginx<span class="w"> </span>--tail<span class="o">=</span><span class="m">1</span>
<span class="go">127.0.0.1 - - [06/Mar/2023:18:27:10 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.79.1&quot; &quot;-&quot;</span>
</pre></div>
</div>
<p>Также можно ограничить вывод по времени опциями <code class="docutils literal notranslate"><span class="pre">--since=&lt;t&gt;</span></code>, где <code class="docutils literal notranslate"><span class="pre">&lt;t&gt;</span></code> - относительное время,
например <code class="docutils literal notranslate"><span class="pre">5m</span></code> - за последние 5 минут. А также опцией <code class="docutils literal notranslate"><span class="pre">--since-time=&lt;f&gt;</span></code>, где <code class="docutils literal notranslate"><span class="pre">&lt;f&gt;</span></code> - время
в формате <a class="reference external" href="https://www.rfc-editor.org/rfc/rfc3339">RFC3339</a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>logs<span class="w"> </span>nginx<span class="w"> </span>--since-time<span class="o">=</span><span class="s1">&#39;2023-03-06T18:10:00Z&#39;</span>
<span class="go">127.0.0.1 - - [06/Mar/2023:18:27:10 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.79.1&quot; &quot;-&quot;</span>
</pre></div>
</div>
<p>Если процесс в контейнере не указывает временные отметки в логах, то можно их добавить опцией
<code class="docutils literal notranslate"><span class="pre">--timestamps</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>logs<span class="w"> </span>nginx<span class="w"> </span>--timestamps
<span class="go">2023-03-06T18:02:22.892400062Z /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration</span>
<span class="go">2023-03-06T18:02:22.892484132Z /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/</span>
<span class="go">2023-03-06T18:02:22.899665882Z /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh</span>
<span class="go">2023-03-06T18:02:22.912301591Z 10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf</span>
<span class="go">2023-03-06T18:02:22.922720728Z 10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf</span>
<span class="go">2023-03-06T18:02:22.924250668Z /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh</span>
<span class="go">2023-03-06T18:02:22.930897003Z /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh</span>
<span class="go">2023-03-06T18:02:22.934077876Z /docker-entrypoint.sh: Configuration complete; ready for start up</span>
<span class="go">2023-03-06T18:02:22.940752160Z 2023/03/06 18:02:22 [notice] 1#1: using the &quot;epoll&quot; event method</span>
<span class="go">2023-03-06T18:02:22.940780609Z 2023/03/06 18:02:22 [notice] 1#1: nginx/1.23.3</span>
<span class="go">2023-03-06T18:02:22.940791331Z 2023/03/06 18:02:22 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6)</span>
<span class="go">2023-03-06T18:02:22.940797071Z 2023/03/06 18:02:22 [notice] 1#1: OS: Linux 4.19.130-boot2docker</span>
<span class="go">2023-03-06T18:02:22.940800309Z 2023/03/06 18:02:22 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576</span>
<span class="go">2023-03-06T18:02:22.941055633Z 2023/03/06 18:02:22 [notice] 1#1: start worker processes</span>
<span class="go">2023-03-06T18:02:22.941072933Z 2023/03/06 18:02:22 [notice] 1#1: start worker process 35</span>
<span class="go">2023-03-06T18:02:22.941076973Z 2023/03/06 18:02:22 [notice] 1#1: start worker process 36</span>
<span class="go">2023-03-06T18:02:22.941466310Z 2023/03/06 18:02:22 [notice] 1#1: start worker process 37</span>
<span class="go">2023-03-06T18:02:22.941796944Z 2023/03/06 18:02:22 [notice] 1#1: start worker process 38</span>
<span class="go">2023-03-06T18:27:10.252486288Z 127.0.0.1 - - [06/Mar/2023:18:27:10 +0000] &quot;GET / HTTP/1.1&quot; 200 615 &quot;-&quot; &quot;curl/7.79.1&quot; &quot;-&quot;</span>
</pre></div>
</div>
<p>Создадим под с несколькими контейнерами:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>k<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>--all
$<span class="w"> </span>k<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Pod</span>
<span class="s">metadata:</span>
<span class="s">  labels:</span>
<span class="s">    run: nginx</span>
<span class="s">  name: nginx</span>
<span class="s">spec:</span>
<span class="s">  containers:</span>
<span class="s">  - image: nginx</span>
<span class="s">    name: nginx</span>
<span class="s">  - image: busybox</span>
<span class="s">    name: date</span>
<span class="s">    command: [/bin/sh, -c, &#39;while sleep 10;do date;done&#39;]</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>Если контейнеров в поде несколько, то можно воспользоваться опцией <code class="docutils literal notranslate"><span class="pre">-c</span></code> или <code class="docutils literal notranslate"><span class="pre">--container</span></code> для
указания конкретного контейнера. Для получения логов всех контейнеров есть опция <code class="docutils literal notranslate"><span class="pre">--all-containers</span></code>.
Для того, чтобы было понятно какой именно контейнер вывел строку, можно добавить опцию <code class="docutils literal notranslate"><span class="pre">--prefix</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>logs<span class="w"> </span>nginx<span class="w"> </span>-c<span class="w"> </span>date
<span class="go">Mon Mar  6 19:34:49 UTC 2023</span>
<span class="gp">$ </span>k<span class="w"> </span>logs<span class="w"> </span>nginx<span class="w"> </span>--all-containers<span class="w"> </span>--prefix<span class="w"> </span>--tail<span class="o">=</span><span class="m">5</span>
<span class="go">[pod/nginx/date] Mon Mar  6 19:34:49 UTC 2023</span>
<span class="go">[pod/nginx/date] Mon Mar  6 19:35:02 UTC 2023</span>
<span class="go">[pod/nginx/date] Mon Mar  6 19:35:19 UTC 2023</span>
<span class="go">[pod/nginx/nginx] 2023/03/06 19:34:37 [notice] 1#1: start worker processes</span>
<span class="go">[pod/nginx/nginx] 2023/03/06 19:34:37 [notice] 1#1: start worker process 35</span>
<span class="go">[pod/nginx/nginx] 2023/03/06 19:34:37 [notice] 1#1: start worker process 36</span>
<span class="go">[pod/nginx/nginx] 2023/03/06 19:34:37 [notice] 1#1: start worker process 37</span>
<span class="go">[pod/nginx/nginx] 2023/03/06 19:34:37 [notice] 1#1: start worker process 38</span>
</pre></div>
</div>
<p>Для постоянного отслеживания новых сообщений в логе есть опция <code class="docutils literal notranslate"><span class="pre">-f</span></code> или <code class="docutils literal notranslate"><span class="pre">--follow</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>logs<span class="w"> </span>nginx<span class="w"> </span>-c<span class="w"> </span>date<span class="w"> </span>-f
<span class="go">Mon Mar  6 19:34:49 UTC 2023</span>
<span class="go">Mon Mar  6 19:35:02 UTC 2023</span>
<span class="go">Mon Mar  6 19:35:19 UTC 2023</span>
<span class="go">Mon Mar  6 19:35:35 UTC 2023</span>
<span class="go">Mon Mar  6 19:35:49 UTC 2023</span>
<span class="go">Mon Mar  6 19:36:02 UTC 2023</span>
</pre></div>
</div>
</section>
<section id="id4">
<h2>Проброс портов<a class="headerlink" href="#id4" title="Permalink to this heading"></a></h2>
<p>Есть несколько способов отправлять сетевые запросы внутрь пода, наиболее простой - это проброс
портов на localhost командой <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">port-forward</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>port-forward<span class="w"> </span>nginx<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span><span class="p">&amp;</span>
<span class="go">Forwarding from 127.0.0.1:8080 -&gt; 80</span>
<span class="go">Forwarding from [::1]:8080 -&gt; 80</span>
</pre></div>
</div>
<p>Команда запускается с символом <code class="docutils literal notranslate"><span class="pre">&amp;</span></code> в конце для того, чтобы она продолжила работу в фоновом режиме и
отдала нам управление терминалом. Из ее вывода видно, что запросы с адреса <code class="docutils literal notranslate"><span class="pre">127.0.0.1:8080</span></code> будут
перенаправляться в контейнер на порт <code class="docutils literal notranslate"><span class="pre">80</span></code>. Можно использовать команду <code class="docutils literal notranslate"><span class="pre">curl</span></code>, которая обычно есть
по умолчанию, для отправки HTTP запроса в контейнер.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl<span class="w"> </span>localhost:8080
<span class="go">Handling connection for 8080</span>
<span class="go">&lt;!DOCTYPE html&gt;</span>
<span class="go">&lt;html&gt;</span>
<span class="go">&lt;head&gt;</span>
<span class="go">&lt;title&gt;Welcome to nginx!&lt;/title&gt;</span>
<span class="go">&lt;style&gt;</span>
<span class="go">html { color-scheme: light dark; }</span>
<span class="go">body { width: 35em; margin: 0 auto;</span>
<span class="go">font-family: Tahoma, Verdana, Arial, sans-serif; }</span>
<span class="go">&lt;/style&gt;</span>
<span class="go">&lt;/head&gt;</span>
<span class="go">&lt;body&gt;</span>
<span class="go">&lt;h1&gt;Welcome to nginx!&lt;/h1&gt;</span>
<span class="go">&lt;p&gt;If you see this page, the nginx web server is successfully installed and</span>
<span class="go">working. Further configuration is required.&lt;/p&gt;</span>

<span class="go">&lt;p&gt;For online documentation and support please refer to</span>
<span class="go">&lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;</span>
<span class="go">Commercial support is available at</span>
<span class="go">&lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;</span>

<span class="go">&lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;</span>
<span class="go">&lt;/body&gt;</span>
<span class="go">&lt;/html&gt;</span>
</pre></div>
</div>
<p>Как видно nginx нам ответил своей стандартной страницей приветствия.</p>
</section>
<section id="id5">
<h2>Запуск команд в контейнере<a class="headerlink" href="#id5" title="Permalink to this heading"></a></h2>
<p>Запустить команду в контейнере можно с помощью <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">exec</span></code>, если контейнеров несколько, то
конкретный можно указать опцией <code class="docutils literal notranslate"><span class="pre">-c</span></code> или <code class="docutils literal notranslate"><span class="pre">--container</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-c<span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w"> </span>--<span class="w"> </span>hostname
<span class="go">nginx</span>
</pre></div>
</div>
<p>Для запуска в контейнере командной оболочки в интерактивном режиме следует добавить опции
<code class="docutils literal notranslate"><span class="pre">-i</span></code> - для возможности ввода через стандартный ввод и <code class="docutils literal notranslate"><span class="pre">-t</span></code> для выделения устройства псевдотерминала.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-c<span class="w"> </span>nginx<span class="w"> </span>nginx<span class="w"> </span>--<span class="w"> </span>/bin/bash
<span class="gp">root@nginx:/# </span><span class="nb">pwd</span>
<span class="go">/</span>
<span class="gp">root@nginx:/# </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;hello&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>/usr/share/nginx/html/index.html
<span class="gp">root@nginx:/# </span><span class="nb">exit</span>
<span class="go">exit</span>
<span class="gp">$ </span>curl<span class="w"> </span>localhost:8080
<span class="go">Handling connection for 8080</span>
<span class="go">hello</span>
</pre></div>
</div>
<p>Здесь видно как можно изменить файл <code class="docutils literal notranslate"><span class="pre">index.html</span></code> изнутри контейнера, который отдает nginx.</p>
</section>
<section id="id6">
<h2>Копирование файлов контейнера<a class="headerlink" href="#id6" title="Permalink to this heading"></a></h2>
<p>Копировать файлы контейнера можно командой <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">cp</span></code>, для этого в контейнере должна быть
утилита <code class="docutils literal notranslate"><span class="pre">tar</span></code>. По сути это удобная обертка над командой <code class="docutils literal notranslate"><span class="pre">kubectl</span> <span class="pre">exec</span></code>. Конкретный контейнер
также можно указать опцией <code class="docutils literal notranslate"><span class="pre">-c</span></code> или <code class="docutils literal notranslate"><span class="pre">--container</span></code>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>cp<span class="w"> </span>-c<span class="w"> </span>nginx<span class="w"> </span>nginx:/usr/share/nginx/html/index.html<span class="w"> </span>./index.html
<span class="go">tar: Removing leading `/&#39; from member names</span>
<span class="gp">$ </span>cat<span class="w"> </span>./index.html
<span class="go">hello</span>
<span class="gp">$ </span><span class="nb">echo</span><span class="w"> </span><span class="s1">&#39;world&#39;</span><span class="w"> </span>&gt;<span class="w"> </span>./index.html
<span class="gp">$ </span>k<span class="w"> </span>cp<span class="w"> </span>./index.html<span class="w"> </span>-c<span class="w"> </span>nginx<span class="w"> </span>nginx:/usr/share/nginx/html/index.html
<span class="gp">$ </span>curl<span class="w"> </span>localhost:8080
<span class="go">Handling connection for 8080</span>
<span class="go">world</span>
</pre></div>
</div>
</section>
<section id="configmap-secret">
<h2>Использование ConfigMap/Secret<a class="headerlink" href="#configmap-secret" title="Permalink to this heading"></a></h2>
<p>Для передачи параметров внутрь контейнера есть удобный способ с использованием ресурсов
<strong>ConfigMap</strong> и <strong>Secret</strong>. Сами объекты представляют из себя структуру данных в виде ключ-значение.
В поде их можно использовать смонтировав в файловую систему как файл или в переменных среды.</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>$<span class="w"> </span>k<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: ConfigMap</span>
<span class="s">metadata:</span>
<span class="s">  name: html</span>
<span class="s">data:</span>
<span class="s">  index.html: hello world</span>
<span class="s">EOF</span>
$<span class="w"> </span>k<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Secret</span>
<span class="s">metadata:</span>
<span class="s">  creationTimestamp: null</span>
<span class="s">  name: envs</span>
<span class="s">stringData:</span>
<span class="s">  ENV_NAME: ENV_VALUE</span>
<span class="s">EOF</span>
$<span class="w"> </span>k<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>--all
$<span class="w"> </span>k<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>-<span class="w"> </span><span class="s">&lt;&lt;EOF</span>
<span class="s">apiVersion: v1</span>
<span class="s">kind: Pod</span>
<span class="s">metadata:</span>
<span class="s">  name: nginx</span>
<span class="s">spec:</span>
<span class="s">  containers:</span>
<span class="s">  - image: nginx</span>
<span class="s">    name: nginx</span>
<span class="s">    envFrom:</span>
<span class="s">    - secretRef:</span>
<span class="s">        name: envs</span>
<span class="s">    volumeMounts:</span>
<span class="s">    - mountPath: /usr/share/nginx/html</span>
<span class="s">      name: html</span>
<span class="s">  volumes:</span>
<span class="s">  - name: html</span>
<span class="s">    configMap:</span>
<span class="s">      name: html</span>
<span class="s">EOF</span>
</pre></div>
</div>
<p>После пересоздания пода проброс портов нужно сделать заново и можно убедиться, что данные из
<strong>ConfigMap</strong> и <strong>Secret</strong> попали в под.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>k<span class="w"> </span>port-forward<span class="w"> </span>nginx<span class="w"> </span><span class="m">8080</span>:80<span class="w"> </span><span class="p">&amp;</span>
<span class="go">Forwarding from 127.0.0.1:8080 -&gt; 80</span>
<span class="go">Forwarding from [::1]:8080 -&gt; 80</span>
</pre></div>
</div>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>curl<span class="w"> </span>localhost:8080
<span class="go">Handling connection for 8080</span>
<span class="go">hello world</span>
<span class="gp">$ </span>k<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>nginx<span class="w"> </span>--<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;echo $ENV_NAME&#39;</span>
<span class="go">ENV_VALUE</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Нижняя область">
        <a href="01_practice_core.html" class="btn btn-neutral float-left" title="Основы работы с kubernetes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Предыдущая</a>
        <a href="03_practice_workloads.html" class="btn btn-neutral float-right" title="Workloads" accesskey="n" rel="next">Следующая <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Алексей Юдолевич.</p>
  </div>

  Собрано при помощи <a href="https://www.sphinx-doc.org/">Sphinx</a> с использованием
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">темы,</a>
    предоставленной <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>